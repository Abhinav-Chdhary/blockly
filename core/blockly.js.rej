*** 943,968 ****
    var expandOption = {enabled: hasCollapsedBlocks};
      expandOption.text = Blockly.Msg.EXPAND_ALL;
      expandOption.callback = function() {
+       Blockly.Instrument.initializeStats("expandAllCollapsedBlocks");
+       Blockly.Instrument.timer(
+           function () {
+             var ms = 0;
+             for (var i = 0; i < topBlocks.length; i++) {
+               var block = topBlocks[i];
+               while (block) {
+                 setTimeout(block.setCollapsed.bind(block, false), ms);
+                 block = block.getNextBlock();
+                 ms += COLLAPSE_DELAY;
+               }
+             }
+             Blockly.resetWorkspaceArrangements();
+           },
+           function (result, timeDiff) {
+             Blockly.Instrument.stats.totalTime = timeDiff;
+             Blockly.Instrument.displayStats("expandAllCollapsedBlocks");
+           }
+       );
      };
      options.push(expandOption);
    }
